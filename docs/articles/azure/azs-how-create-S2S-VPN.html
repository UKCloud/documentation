<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>How to create a site-to-site connection Using the Azure Stack portal | UKCloud Ltd | UKCloud Knowledge Centre </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="How to create a site-to-site connection Using the Azure Stack portal | UKCloud Ltd | UKCloud Knowledge Centre ">
    <meta name="generator" content="docfx 2.40.11.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-margin-left">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                
                <a class="navbar-brand" href="../../index.html">
                  <img id="logo" class="svg" src="../../logo.png" alt="">
                </a>
              </div>
              <div class="collapse navbar-collapse" id="navbar">
                <form class="navbar-form navbar-right" role="search" id="search">
                  <div class="form-group">
                    <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </nav>
        
        <div class="navbar-borderless subnav navbar navbar-default">
          <div class="navbar-right subnav-margin-right">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/UKCloud/documentation/blob/master/articles/azure/azs-how-create-S2S-VPN.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
          </div>
          <div class="hide-when-search subnav-margin-left" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container-fluid body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-10">
                <article class="content wrap" id="_content" data-uid="">
                  
<h1 id="how-to-create-a-site-to-site-connection-using-the-azure-stack-portal">How to create a site-to-site connection using the Azure Stack portal</h1>

<h2 id="overview">Overview</h2>
<p>This guide shows you how to use the UKCloud Azure Stack portal to create a Site-to-Site VPN from your on-premises network to your UKCloud for Microsoft Azure environment.</p>
<h3 id="intended-audience">Intended audience</h3>
<p>To complete the steps in this guide, you must have appropriate access to a subscription in the UKCloud Azure Stack portal.</p>
<h2 id="create-a-virtual-network">Create a virtual network</h2>
<p>First, you'll need to create a virtual network. This virtual network will be able to send and receive traffic through the virtual network gateway. You cannot associate a virtual network with more than one gateway.</p>
<ol>
<li><p>Log in to the UKCloud Azure Stack portal.</p>
<p>For more detailed instructions, see the <a href="azs-gs.html"><em>Getting Started Guide for UKCloud for Microsoft Azure</em></a>.</p>
</li>
<li><p>In the favourites panel, select <strong>Create a resource</strong>.</p>
<p><img src="images/azsp_newmenu.png" alt="Create a resource option in favourites panel"></p>
</li>
<li><p>In the <strong>New</strong> blade, select <strong>Networking</strong>.</p>
<p><img src="images/azs-browser-new-networking.png" alt="Networking option in New blade"></p>
</li>
<li><p>In the <strong>Featured</strong> section, select <strong>Virtual network</strong>.</p>
<p><img src="images/azs-browser-networking-create.png" alt="Create new networking resource"></p>
</li>
<li><p>In the <strong>Create virtual network</strong> blade, enter the following information:</p>
<ul>
<li><p><strong>Name</strong> - The name of the virtual network.</p>
</li>
<li><p><strong>Address Space</strong> - The virtual network's address range in CIDR notation.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource Group</strong> - Select an existing resource group, or create a new one by typing a name for your new resource group.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
</li>
<li><p><strong>Subnet Name</strong> - The name of the first subnet within the virtual network.</p>
</li>
<li><p><strong>Address Range</strong> - The subnet's address range in CIDR notation (for example, 192.168.1.0). It must be contained by the address space of the virtual network. The address range of a subnet which is in use can't be edited.</p>
<p><img src="images/azs-browser-create-virtual-network.png" alt="Create new virtual network"></p>
</li>
</ul>
</li>
<li><p>Click <strong>Create</strong>.</p>
</li>
<li><p>You can monitor the progress of your virtual network's deployment by clicking the <strong>Notifications</strong> icon.</p>
<p><img src="images/azsp_createvm_progress.png" alt="!Notification showing VM deployment in progress"></p>
</li>
<li><p>Click the deployment notification for the deployment to view details of the deployment of the virtual network.</p>
</li>
<li><p>When the deployment is finished, the notification will change to <strong>Deployment succeeded</strong>.</p>
</li>
<li><p>After your virtual network has deployed, you can view it by clicking <strong>All services</strong> in the favourites panel, then selecting <strong>Virtual networks</strong> under the networking section.</p>
</li>
<li><p>Select your virtual network from the list.</p>
</li>
<li><p>In the blade for your virtual network, you can view and monitor the virtual network, change its settings and perform diagnostics and troubleshooting.</p>
</li>
</ol>
<h2 id="create-the-gateway-subnet">Create the gateway subnet</h2>
<p>To associate a virtual network with a gateway, it must first contain a valid gateway subnet. The following steps outline how to create a gateway subnet.</p>
<ol>
<li><p>In the portal, navigate to the virtual network that you created in the previous section.</p>
</li>
<li><p>In the <strong>Settings</strong> section of the virtual network blade, select <strong>Subnets</strong>.</p>
</li>
<li><p>On the <strong>Subnets</strong> page, click the <strong>+ Gateway Subnet</strong> button.</p>
</li>
<li><p>Fill in the <strong>Address range</strong> and add a route table if required, then click <strong>OK</strong>. The subnet should now have appeared.</p>
</li>
</ol>
<h2 id="create-the-vpn-gateway">Create the VPN gateway</h2>
<ol>
<li><p>In the favourites panel, select <strong>Create a resource</strong>.</p>
<p><img src="images/azsp_newmenu.png" alt="Create a resource option in favourites panel"></p>
</li>
<li><p>In the <strong>New</strong> blade, select <strong>Networking</strong>.</p>
<p><img src="images/azs-browser-new-networking.png" alt="Networking option in New blade"></p>
</li>
<li><p>In the <strong>Featured</strong> section, select <strong>Virtual network gateway</strong>.</p>
<p><img src="images/azs-browser-networking-create.png" alt="Create new networking resource"></p>
</li>
<li><p>In the <strong>Create virtual network gateway</strong> blade, enter the following information:</p>
<ul>
<li><p><strong>Name</strong> - The name of the virtual network gateway.</p>
</li>
<li><p><strong>SKU</strong> - Route-based VPN gateway types are offered in three SKUs: Basic, Standard, and High performance. You must select Standard or High performance if you are creating the network to coexist with an ExpressRoute gateway. You must select High performance SKU to enable active-active mode. You can find more information about SKUs here: <a href="https://docs.microsoft.com/en-gb/azure/vpn-gateway/vpn-gateway-about-skus-legacy">Azure Stack SKUs</a>.</p>
</li>
<li><p><strong>Virtual Network</strong> - This is the virtual network that you created earlier.</p>
</li>
<li><p><strong>Public IP address</strong> - The public IP address to assign to this virtual network gateway. Only dynamic public IP addresses are supported. To create a new public IP address:</p>
<ul>
<li><p>Click <strong>Public IP address</strong> on the <strong>Create virtual network gateway</strong> blade.</p>
</li>
<li><p>Select <strong>Create new</strong> on the <strong>Choose public IP address</strong> blade.</p>
</li>
<li><p>Enter a name for the public IP address and click <strong>OK</strong>.</p>
</li>
</ul>
</li>
<li><p><strong>Configure BGP ASN</strong> - BGP is the standard routing protocol commonly used on the internet to exchange routing information between two or more networks. BGP enables the Azure VPN Gateways and your on-premises VPN devices, called BGP peers or neighbours, to exchange &quot;routes&quot; that will inform both gateways on the availability and reachability for those prefixes to go through the gateways or routers involved. You should also make sure your on-premises VPN devices support BGP before you enable this feature.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource Group</strong> - The virtual network gateway will be created in the same resource group as the chosen virtual network.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
<p><img src="images/azs-browser-create-Vnetwork-gateway.png" alt="Create new virtual network gateway"></p>
</li>
</ul>
</li>
<li><p>Click <strong>Create</strong>.</p>
</li>
<li><p>You can monitor the progress of your virtual network's deployment by clicking the <strong>Notifications</strong> icon.</p>
<p><img src="images/azsp_createvm_progress.png" alt="!Notification showing VM deployment in progress"></p>
</li>
</ol>
<h2 id="create-the-local-network-gateway">Create the local network gateway</h2>
<p>The local network gateway refers to your on-premises network. The following steps outline how to create a local network gateway:</p>
<ol>
<li><p>In the favourites panel, select <strong>Create a resource</strong>.</p>
<p><img src="images/azsp_newmenu.png" alt="Create a resource option in favourites panel"></p>
</li>
<li><p>In the <strong>New</strong> blade, select <strong>Networking</strong>.</p>
<p><img src="images/azs-browser-new-networking.png" alt="Networking option in New blade"></p>
</li>
<li><p>In the <strong>Featured</strong> section, select <strong>Local network gateway</strong>.</p>
<p><img src="images/azs-browser-networking-create.png" alt="Create new networking resource"></p>
</li>
<li><p>In the <strong>Create local network gateway</strong> blade, enter the following information:</p>
<ul>
<li><p><strong>Name</strong> - The name of the local network gateway.</p>
</li>
<li><p><strong>IP address</strong> - This is the public IP address of the VPN device that you want Azure to connect to. Specify a valid public IP address.</p>
</li>
<li><p><strong>Address space</strong> - One or more IP address ranges (in CIDR notation) that define your local network's address space. For example: 192.168.0.0/16. If you plan to use this local network gateway in a BGP-enabled connection, then the minimum prefix you need to declare is the host address of your BGP Peer IP address on your VPN device.</p>
</li>
<li><p><strong>Configure BGP settings</strong> - Use only when configuring BGP.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource group</strong> - Select an existing resource group, or create a new one by typing a name for your new resource group.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
<p><img src="images/azs-browser-create-Lnetwork-gateway.png" alt="Create new local network gateway"></p>
</li>
</ul>
</li>
<li><p>Click <strong>Create</strong>.</p>
</li>
</ol>
<h2 id="create-the-vpn-connection">Create the VPN connection</h2>
<p>Create the Site-to-Site VPN connection between your virtual network gateway and your on-premises VPN device:</p>
<ol>
<li><p>Navigate to your virtual network gateway by clicking <strong>All services</strong> in the favourites panel, then selecting <strong>Virtual network gateways</strong> under the networking section.</p>
</li>
<li><p>Select your virtual network gateway from the list.</p>
</li>
<li><p>In the blade for your virtual network gateway, select <strong>Connections</strong> under the <strong>Settings</strong> section.</p>
</li>
<li><p>Click the <strong>+Add</strong> button.</p>
</li>
<li><p>In the <strong>Add connection</strong> blade, enter the following information:</p>
<ul>
<li><p><strong>Name</strong> - The name of the connection.</p>
</li>
<li><p><strong>Connection type</strong> - Select <strong>Site-to-site (IPSec)</strong>.</p>
</li>
<li><p><strong>Virtual network gateway</strong> - Select the virtual network gateway you created earlier.</p>
</li>
<li><p><strong>Local network gateway</strong>- Select the local network gateway you created earlier.</p>
</li>
<li><p><strong>Shared Key</strong> - A mixture of letters and numbers, used to establish encryption for the connection. You must use the same shared key in both the virtual network and local network gateways. If your gateway device doesn't provide one, you can make one up here and provide it to your device.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource Group</strong> - When adding a connection for an existing peer, the resource group can't be changed.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
<p><img src="images/azs-browser-add-connection.png" alt="Add new connection"></p>
</li>
</ul>
</li>
<li><p>Click <strong>OK</strong>.</p>
</li>
</ol>
<h2 id="verify-the-vpn-connection">Verify the VPN connection</h2>
<p>After configuring the VPN device on your local network, you can verify the VPN connection with the following steps:</p>
<ol>
<li><p>Navigate to your virtual network gateway by clicking <strong>All services</strong> in the favourites panel, then selecting <strong>Virtual network gateways</strong> under the networking section.</p>
</li>
<li><p>Select your virtual network gateway from the list.</p>
</li>
<li><p>In the blade for your virtual network gateway, select <strong>Connections</strong> under the <strong>Settings</strong> section.</p>
</li>
<li><p>Select your connection from the list.</p>
</li>
<li><p>In the blade that has opened, you can view more information about your connection. The connection status will be <strong>Succeeded</strong> or <strong>Connected</strong> if there is a successful connection.</p>
</li>
</ol>
<h2 id="feedback">Feedback</h2>
<p>If you find an issue with this article, click <strong>Improve this Doc</strong> to suggest a change. If you have an idea for how we could improve any of our services, visit <a href="https://ideas.ukcloud.com">UKCloud Ideas</a>. Alternatively, you can contact us at <a href="mailto:products@ukcloud.com">products@ukcloud.com</a>.</p>


                  <div class="row">
                  </div>
                </article>
              </div>
              
              <div class="hidden-sm col-md-2" role="complementary">
                <div class="sideaffix">
                  <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                  <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right text-right">
              Generated by <strong>DocFX</strong><br>
              <a href="#top">Back to top</a>
            </span>
            <span>&copy <a href="http://ukcloud.com">UKCloud Ltd</a>, 2019. All Rights Reserved.<br><a href="https://ukcloud.com/legal">Privacy Policy. </a><a href="https://ukcloud.com/terms-and-conditions">Terms of Use. </a><a href="http://docs.ukcloud.com/articles/other/other-how-contribute-knowledge.html">Contribute. </a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    <script type="text/javascript" src="../../styles/highlight.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-57433193-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-57433193-6');
    </script>  </body>
</html>
