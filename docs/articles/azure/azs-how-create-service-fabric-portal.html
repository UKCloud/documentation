<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>How to create a Service Fabric cluster using the UKCloud Azure Stack portal | UKCloud Ltd | UKCloud Knowledge Centre </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="How to create a Service Fabric cluster using the UKCloud Azure Stack portal | UKCloud Ltd | UKCloud Knowledge Centre ">
    <meta name="generator" content="docfx 2.45.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container-fluid">
            <div class="navbar-margin-left">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                
                <a class="navbar-brand" href="../../index.html">
                  <img id="logo" class="svg" src="../../styles/assets/logo.png" srcset="../../styles/assets/logo@2x.png 2x" width="300" height="49" alt="">
                </a>
              </div>
              <div class="collapse navbar-collapse" id="navbar">
                <form class="navbar-form navbar-right" role="search" id="search">
                  <div class="form-group">
                    <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </nav>
        
        <div class="navbar-borderless subnav navbar navbar-default">
          <div class="navbar-right subnav-margin-right">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/UKCloud/documentation/blob/master/articles/azure/azs-how-create-service-fabric-portal.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
          </div>
          <div class="hide-when-search subnav-margin-left" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container-fluid body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="container-fluid">
            <div class="row">
              <div class="col-lg-10">
                <article class="content wrap" id="_content" data-uid="">
                  
<h1 id="how-to-create-a-service-fabric-cluster-using-the-ukcloud-azure-stack-portal">How to create a Service Fabric cluster using the UKCloud Azure Stack portal</h1>

<h2 id="overview">Overview</h2>
<p>Azure Stack Service Fabric is a distributed systems platform that makes it easy to package, deploy, and manage scalable and reliable microservices and containers. Service Fabric also addresses the significant challenges in developing and managing cloud native applications. Developers and administrators can avoid complex infrastructure problems and focus on implementing mission-critical, demanding workloads that are scalable, reliable, and manageable. Service Fabric represents the next-generation platform for building and managing these enterprise-class, tier-1, cloud-scale applications running in containers.</p>
<p>The following process shows you how to setup a Service Fabric cluster using the Azure Stack portal.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>To complete the steps in this guide, you must have appropriate access to a subscription in the Azure Stack portal.</p>
<h2 id="creating-a-new-key-vault">Creating a new key vault</h2>
<p>Before creating a Service Fabric cluster, it is necessary to create a key vault to store the certificates for the cluster. These certificates are used in Service Fabric to provide authentication and encryption to secure various aspects of a cluster and its applications. You can find more information about these certificates <a href="https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-security#x509-certificates-and-service-fabric">here</a>.</p>
<ol>
<li><p>Log in to the Azure Stack portal.</p>
<p>For more detailed instructions, see the <a href="azs-gs.html"><em>Getting Started Guide for UKCloud for Microsoft Azure</em></a>.</p>
</li>
<li><p>In the favourites panel, select <strong>Create a resource</strong>.</p>
<p><img src="images/azsp_newmenu.png" alt="New option in favourites panel"></p>
</li>
<li><p>In the <em>New</em> blade, select <strong>Security + Identity</strong>.</p>
<p><img src="images/azs-browser-new-security.png" alt="Security option in New blade"></p>
</li>
<li><p>In the <em>New</em> blade, select <strong>Key Vault</strong>.</p>
<p><img src="images/azs-browser-new-key-vault.png" alt="New Key Vault"></p>
</li>
<li><p>In the <em>Create key vault</em> blade, enter the following information:</p>
<ul>
<li><p><strong>Name</strong> - The name of the key vault.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource Group</strong> - Select an existing resource group, or create a new one by typing a name for your new resource group.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
</li>
<li><p><strong>Access policies</strong> - Configure who can access the key vault and what permissions they have.</p>
<p><img src="images/azs-browser-create-key-vault.png" alt="Create new key vault"></p>
</li>
</ul>
</li>
<li><p>Click <strong>Create</strong>.</p>
</li>
<li><p>You can monitor the progress of your Key Vault's deployment by clicking the <strong>Notifications</strong> icon.</p>
<p><img src="images/azsp_createvm_progress.png" alt="!Notification showing vault deployment in progress"></p>
</li>
</ol>
<h3 id="adding-a-certificate-to-the-key-vault">Adding a certificate to the key vault</h3>
<ol>
<li><p>Once the key vault has been deployed, navigate to it by clicking <strong>All services</strong> in the favourites panel, then selecting <strong>Key Vaults</strong> under the <em>Security + Identity</em> section.</p>
</li>
<li><p>Select your key vault from the list.</p>
</li>
<li><p>In the <em>Settings</em> section of the key vault blade, select <strong>Secrets</strong>.</p>
</li>
<li><p>On the <em>Secrets</em> page, click the <strong>+ Generate/Import</strong> button.</p>
</li>
<li><p>In the <em>Create a secret</em> blade, enter the following information:</p>
<ul>
<li><p><strong>Upload Options</strong> - Select the <strong>Certificate</strong> option.</p>
</li>
<li><p><strong>Upload Certificate</strong> - Select the .pfx certificate to upload.</p>
</li>
<li><p><strong>Name</strong> - The name of the certificate to identify it within the Key Vault.</p>
</li>
<li><p><strong>Activation Date</strong> - Specifies when the certificate will become active.</p>
</li>
<li><p><strong>Expiration Date</strong> - Specifies when the certificate will become inactive.</p>
</li>
<li><p><strong>Enabled</strong> - Indicates whether or not the secret data can be retrieved.</p>
</li>
</ul>
<p><img src="images/azs-browser-add-certificate.png" alt="Create a new secret"></p>
</li>
<li><p>Click <strong>Create</strong>.</p>
</li>
<li><p>Repeat as necessary, depending on how many certificates you require.</p>
</li>
</ol>
<h3 id="gathering-key-vault-and-certificate-information">Gathering key vault and certificate information</h3>
<p>During configuration of the Service Fabric cluster, you must provide several details relating to the key vault and certificates. You must also configure access to the key vault for virtual machines and the Azure Resource Manager.</p>
<ol>
<li><p>Once you have deployed the key vault, navigate to it by clicking <strong>All services</strong> in the favourites panel, then selecting <strong>Key Vaults</strong> under the <em>Security + Identity</em> section.</p>
</li>
<li><p>Select your key vault from the list.</p>
</li>
<li><p>In the <em>Settings</em> section of the key vault's blade, select <strong>Access Properties</strong>.</p>
</li>
<li><p>On the <em>Access policies</em> page, click <strong>Click to show advanced access policies</strong>.</p>
</li>
<li><p>Tick the top two check boxes, then click the <strong>Save</strong> button.</p>
</li>
<li><p>In the <em>Settings</em> section of the key vault blade, select <strong>Properties</strong>.</p>
</li>
<li><p>Copy the <strong>Resource ID</strong> and store it for later use.</p>
</li>
<li><p>Select <strong>Secrets</strong>.</p>
</li>
<li><p>On the <em>Secrets</em> page, select the certificate you added in the previous section.</p>
</li>
<li><p>On the certificate's blade, select the current version.</p>
</li>
<li><p>Copy the <strong>Secret Identifier</strong>.</p>
</li>
<li><p>Repeat for each certificate that you are going to use for the Service Fabric cluster.</p>
</li>
</ol>
<p>You also need the thumbprint of the certificate(s). For information about how to find this information, see <a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate">here</a>.</p>
<h2 id="create-a-service-fabric-cluster">Create a Service Fabric cluster</h2>
<ol>
<li><p>In the favourites panel, select <strong>Create a resource</strong>.</p>
<p><img src="images/azsp_newmenu.png" alt="New option in favourites panel"></p>
</li>
<li><p>In the search bar, search for <strong>Service Fabric Cluster</strong>.</p>
<p><img src="images/azsp_computeblade.png" alt="Compute option in New blade"></p>
</li>
<li><p>Select <strong>Service Fabric Cluster</strong> and click <strong>Create</strong>.</p>
</li>
<li><p>In the <strong>Basics</strong> blade, enter the following information and click <strong>OK</strong>:</p>
<ul>
<li><p><strong>Service Fabric Cluster Name</strong> - The name of your cluster.</p>
</li>
<li><p><strong>Node Type Prefix</strong> - Prefix for the name of each node (VM).</p>
</li>
<li><p><strong>Primary Node Type Size</strong> - Size of the VM scale set for the primary node type.</p>
</li>
<li><p><strong>Additional Node Type Sizes</strong> - For every additional node type, add an array with a count of the nodes in each node type. For example, if you want two additional node types with three nodes in each, enter <code>3,3</code> (separating the amount of nodes for each node type with a comma).</p>
</li>
<li><p><strong>Admin Username</strong> - The admin username for each node.</p>
</li>
<li><p><strong>Password</strong> - The admin password for each node.</p>
</li>
<li><p><strong>DNS Service</strong> - Select <strong>Yes</strong> to use DNS service, which is an optional system service that enables you to map DNS names to a service name and discover other services using the DNS protocol. If you have applications with existing URLs that you intend to use with Service Fabric, DNS service will help you use the standard DNS protocol (as an alternative to the Service Fabric Naming service) for resolving service names.</p>
</li>
<li><p><strong>Repair Manager</strong> - Select <strong>Yes</strong> to use Repair Manager to enable patch orchestration on node types with a durability of bronze, which helps keep your VMs up to date.</p>
</li>
<li><p><strong>Service Fabric deployment package URL</strong> - Specify the URL to download the Service Fabric deployment package from. For off-line scenarios, download the service fabric package from the URL specified and upload it to a blob and enable anonymous access and specify the URL here.</p>
</li>
<li><p><strong>Subscription</strong> - This is your UKCloud for Microsoft Azure subscription.</p>
</li>
<li><p><strong>Resource Group</strong> - Select an existing resource group, or create a new one by typing a name for your new resource group. Note that to create a Service Fabric cluster, the resource group must contain no other resources.</p>
</li>
<li><p><strong>Location</strong> - This will be <code>frn00006</code>, which is the location of the Azure Stack.</p>
</li>
</ul>
<p><img src="images/azs-browser-create-sf-basics.png" alt="Create Service Fabric cluster &gt; Basics"></p>
</li>
<li><p>In the <em>Network Settings</em> blade, enter the following information and click <strong>OK</strong>:</p>
<ul>
<li><p><strong>Service Fabric TCP Port</strong> - Service Fabric cluster TCP gateway port to use to connect using the Service Fabric client.</p>
</li>
<li><p><strong>Service Fabric HTTP Port</strong> - Service Fabric cluster HTTP gateway port to use to connect using the Service Fabric Explorer.</p>
</li>
<li><p><strong>Service Fabric Reverse Proxy Port</strong> - Service Fabric cluster reverse proxy port</p>
</li>
<li><p><strong>Custom Application Endpoints</strong> - Custom endpoints to open for connections to applications running on this cluster. Enter endpoints separated by commas, for example, <code>80,8080,8081</code>.</p>
</li>
<li><p><strong>Custom ports to open in the Network Security Group</strong> - Custom ports to open in the Network Security Group. Enter ports separated by commas, for example, <code>3389,80,8080,8081</code>.</p>
</li>
</ul>
<p><img src="images/azs-browser-create-sf-networking.png" alt="Create Service Fabric cluster &gt; Network Settings"></p>
</li>
<li><p>In the <em>Node Configuration</em> blade, enter the following information and click <strong>OK</strong>:</p>
<ul>
<li><p><strong>Image SKU</strong> - The image template that each node is built from.</p>
</li>
<li><p><strong>VM Size</strong> - The size of each node.</p>
</li>
</ul>
<p><img src="images/azs-browser-create-sf-node.png" alt="Create Service Fabric cluster &gt; Node Configuration"></p>
</li>
<li><p>In the <em>Security</em> blade, enter the following information and click <strong>OK</strong>:</p>
<ul>
<li><p><strong>Source Key Vault</strong> - The resource ID of the key vault that you gathered in the previous section. This should be in the format of <strong><code>/subscriptions/&lt;SubscriptionId&gt;/resourceGroups/&lt;ResourceGroupName&gt;/providers/Microsoft.KeyVault/vaults/&lt;VaultName&gt;</code></strong>.</p>
</li>
<li><p><strong>Cluster Certificate URL</strong> - The Secret Identifier of the cluster certificate that you gathered in the previous section. It should be in the format of <strong><code>https://&lt;VaultEndpoint&gt;/secrets/\&lt;SecretName&gt;/&lt;SecretVersion&gt;</code></strong>.</p>
</li>
<li><p><strong>Cluster Certificate thumbprint</strong> - Cluster certificate thumbprint that you gathered earlier. For example, <strong><code>1742635FBCC5F9A442582516A7292523686DE3D7</code></strong>.</p>
</li>
<li><p><strong>Server Certificate URL</strong> - The Secret Identifier of the cluster certificate that you gathered in the previous section. It should be in the format of
<strong><code>https://&lt;VaultEndpoint&gt;/secrets/&lt;SecretName&gt;/&lt;SecretVersion&gt;</code></strong>.</p>
</li>
<li><p><strong>Server Certificate thumbprint</strong> - Server certificate thumbprint that you gathered earlier. For example, <strong><code>1742635FBCC5F9A442582516A7292523686DE3D7</code></strong>.</p>
</li>
<li><p><strong>Use Reverse Proxy Certificate</strong> - You may specify a SSL certificate to be used by the reverse proxy you have enabled. Doing so will cause the reverse proxy to communicate using HTTPS. If no certificate is specified, then the reverse proxy will communicate using HTTP instead.</p>
</li>
<li><p><strong>Admin Client Certificate Thumbprints</strong> - Comma separated list of admin client certificate thumbprints. For example, <strong><code>1742635FBCC5F9A442582516A7292523686DE3D7,0272251171BA32CEC7938A65B8A6A553AA2D3283</code></strong>.</p>
</li>
<li><p><strong>Non-Admin Client Certificate Thumbprints</strong> - Comma separated list of non-admin client certificate thumbprints. For example, <strong><code>1742635FBCC5F9A442582516A7292523686DE3D7,0272251171BA32CEC7938A65B8A6A553AA2D3283</code></strong>.</p>
</li>
</ul>
<p><img src="images/azs-browser-create-sf-security.png" alt="Create Service Fabric cluster &gt; Security"></p>
</li>
<li><p>Click <strong>OK</strong>, then <strong>Create</strong>.</p>
</li>
<li><p>You can monitor the progress of your Key Vault's deployment by clicking the <strong>Notifications</strong> icon.</p>
<p><img src="images/azsp_createvm_progress.png" alt="!Notification showing Service Fabric cluster deployment in progress"></p>
</li>
</ol>
<h2 id="feedback">Feedback</h2>
<p>If you find an issue with this article, click <strong>Improve this Doc</strong> to suggest a change. If you have an idea for how we could improve any of our services, visit the <a href="https://community.ukcloud.com/ideas">Ideas</a> section of the <a href="https://community.ukcloud.com">UKCloud Community</a>.</p>


                  <div class="row">
                  </div>
                </article>
              </div>
              
              <div class="hidden-sm col-md-2" role="complementary">
                <div class="sideaffix">
                  <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                  <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right text-right">
              Generated by <strong>DocFX</strong><br>
              <a href="#top">Back to top</a>
            </span>
            <span>&copy <a href="http://ukcloud.com">UKCloud Ltd</a>, 2019. All Rights Reserved.<br><a href="https://ukcloud.com/legal">Privacy Policy. </a><a href="https://ukcloud.com/terms-and-conditions">Terms of Use. </a><a href="http://docs.ukcloud.com/articles/other/other-how-contribute-knowledge.html">Contribute. </a></span>
          </div>
        </div>
      </footer>
      
      <div id="cookie-cta" style="display: none;" aria-hidden="true">
        <div class="cookie-cta-inner container">
          <div class="cookie-cta-text">
            <p>
              <strong>UKCloud Knowledge Centre</strong> uses cookies to ensure that we give you the best experience on our website. If you continue we assume that you consent to receive all cookies on this website.
            </p>
          </div>
      
          <div class="cookie-cta-action">
            <button class="cookie-cta-close button button--small">Accept</button>
          </div>
        </div>
      </div>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    <script type="text/javascript" src="../../styles/highlight.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-57433193-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-57433193-6');
    </script>  </body>
</html>
